# ADR-002: Domain Model

## Status
Accepted

## Context
AtlasPress X needs a comprehensive domain model that supports:
- Multi-tenant workspaces
- Complex editorial workflows
- Rich content modeling
- Enterprise permissions and governance

## Decision

### Core Entities

#### Workspace (Multi-Tenancy)
```typescript
interface Workspace {
  id: string
  name: string
  slug: string
  domain?: string
  settings: WorkspaceSettings
  subscription: Subscription
  createdAt: Date
  updatedAt: Date
}
```

#### User & Authentication
```typescript
interface User {
  id: string
  email: string
  name: string
  avatar?: string
  emailVerified: Date
  twoFactorEnabled: boolean
  createdAt: Date
  updatedAt: Date
}

interface WorkspaceMember {
  id: string
  userId: string
  workspaceId: string
  role: WorkspaceRole
  permissions: Permission[]
  invitedBy: string
  joinedAt: Date
}
```

#### Content Domain
```typescript
interface Content {
  id: string
  workspaceId: string
  type: ContentType
  title: string
  slug: string
  content: BlockContent[]
  metadata: ContentMetadata
  seo: SEOData
  workflowState: WorkflowState
  authorId: string
  reviewerIds: string[]
  publishedAt?: Date
  scheduledFor?: Date
  createdAt: Date
  updatedAt: Date
}

interface ContentType {
  id: string
  workspaceId: string
  name: string
  slug: string
  schema: BlockSchema[]
  workflowTemplate: WorkflowTemplate
  seoTemplate: SEOTemplate
}
```

#### Editorial Workflow
```typescript
interface WorkflowState {
  id: string
  contentId: string
  state: 'draft' | 'in_review' | 'approved' | 'scheduled' | 'published' | 'archived'
  assignedTo?: string
  dueDate?: Date
  completedAt?: Date
  comments: WorkflowComment[]
  transitions: WorkflowTransition[]
}

interface WorkflowTemplate {
  id: string
  workspaceId: string
  name: string
  states: WorkflowStateDefinition[]
  transitions: WorkflowTransitionRule[]
}
```

#### Media & Assets
```typescript
interface MediaAsset {
  id: string
  workspaceId: string
  filename: string
  originalName: string
  mimeType: string
  size: number
  width?: number
  height?: number
  variants: MediaVariant[]
  metadata: MediaMetadata
  uploadedBy: string
  createdAt: Date
}
```

#### Analytics & Metrics
```typescript
interface ContentMetrics {
  id: string
  contentId: string
  date: Date
  views: number
  engagedTime: number
  depth: number
  bounceRate: number
  conversions: number
  utmSource?: string
  utmMedium?: string
  utmCampaign?: string
}
```

### Relationships
- Workspace → WorkspaceMember (1:N)
- WorkspaceMember → User (N:1)
- Workspace → Content (1:N)
- Content → WorkflowState (1:1)
- Content → ContentMetrics (1:N)
- Workspace → MediaAsset (1:N)
- MediaAsset → Content (N:M via usage)

### Enums & Types
```typescript
enum WorkspaceRole {
  OWNER = 'owner',
  ADMIN = 'admin',
  MANAGING_EDITOR = 'managing_editor',
  EDITOR = 'editor',
  AUTHOR = 'author',
  CONTRIBUTOR = 'contributor',
  ANALYST = 'analyst',
  VIEWER = 'viewer'
}

enum Permission {
  // Workspace permissions
  MANAGE_WORKSPACE = 'manage_workspace',
  MANAGE_MEMBERS = 'manage_members',
  
  // Content permissions
  CREATE_CONTENT = 'create_content',
  EDIT_CONTENT = 'edit_content',
  PUBLISH_CONTENT = 'publish_content',
  DELETE_CONTENT = 'delete_content',
  
  // Media permissions
  UPLOAD_MEDIA = 'upload_media',
  MANAGE_MEDIA = 'manage_media',
  
  // Analytics permissions
  VIEW_ANALYTICS = 'view_analytics',
  EXPORT_REPORTS = 'export_reports'
}

enum ContentType {
  ARTICLE = 'article',
  PAGE = 'page',
  BLOG_POST = 'blog_post',
  LANDING_PAGE = 'landing_page',
  HELP_ARTICLE = 'help_article'
}
```

## Consequences
### Positive
- Clear domain boundaries
- Type-safe relationships
- Scalable data model
- Supports complex business requirements

### Considerations
- Complex join queries may require optimization
- Need careful indexing strategy
- Permission checks must be efficient

## Implementation Notes
- Use Prisma for type-safe database operations
- Implement soft deletes for audit trails
- Add database triggers for timestamp management
- Use composite indexes for common query patterns
